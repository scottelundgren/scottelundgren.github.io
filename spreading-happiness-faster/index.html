<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=en><![endif]--> <!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang=en><![endif]--> <!--[if IE 8]><html class="no-js lt-ie9" lang=en><![endif]--> <!--[if gt IE 8]>><!<![endif]--> <html class=no-js lang=en> <head prefix='og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#'> <meta charset=utf-8> <meta content='width=device-width, initial-scale=1' name=viewport> <meta content='A walkthrough of performance issues affecting a image heavy site in production. Analysis of the server, site design and structure with recommendations how to improve' name=description> <meta content='Scott E Lundgren' name=author> <meta content=4712396 property='fb:admins'> <meta content='http://www.scottelundgren.com/spreading-happiness-faster/' property='og:url'> <meta content='A walkthrough of performance issues affecting a image heavy site in production. Analysis of the server, site design and structure with recommendations how to improve' property='og:description'> <meta content='Scott E Lundgren' property='og:site_name'> <meta content=article property='og:type'> <meta content='http://www.facebook.com/4712396' property='og:article:author'> <meta content=frontend property='og:article:tag'> <meta content=performance property='og:article:tag'> <meta content=infrastructure property='og:article:tag'> <meta content='2013-12-19T00:00:00-05:00' property='og:article:published_time'> <meta content='2014-08-16T19:46:24-04:00' property='og:article:modified_time'> <meta content='Spreading Happiness (Happygifs.co) Faster' property='og:title'> <meta content='' property='og:image'> <meta content=369649440 property='twitter:account_id'> <meta content=summary name='twitter:card'> <meta content='@scottelundgren' name='twitter:site'> <meta content='Spreading Happiness (Happygifs.co) Faster' name='twitter:title'> <meta content='http://www.scottelundgren.com/spreading-happiness-faster/' name='twitter:url'> <meta content='A walkthrough of performance issues affecting a image heavy site in production. Analysis of the server, site design and structure with recommendations how to improve' name='twitter:description'> <meta name='twitter:image:src'> <meta content=a7b89ad3d5baa2a9560c785eb6b0a1da name='p:domain_verify'> <title> Spreading Happiness (Happygifs.co) Faster | Scott E Lundgren </title> <link href='//www.scottelundgren.com/spreading-happiness-faster/' rel=canonical> <link href="//fonts.googleapis.com/css?family=Roboto:300,400,400italic" rel=stylesheet /> <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css" rel=stylesheet /> <link href="/stylesheets/all-b1ae1d6f.css" rel=stylesheet /> <link href='apple-touch-icon-152x152-precomposed.png' rel=apple-touch-icon-precomposed sizes=152x152> <link href='apple-touch-icon-144x144-precomposed.png' rel=apple-touch-icon-precomposed sizes=144x144> <link href='apple-touch-icon-114x114-precomposed.png' rel=apple-touch-icon-precomposed sizes=114x114> <link href='apple-touch-icon-72x72-precomposed.png' rel=apple-touch-icon-precomposed sizes=72x72> <link href='apple-touch-icon-precomposed.png' rel=apple-touch-icon-precomposed> <link href='favicon.png' rel='shortcut icon'> <link href='favicon.ico' rel=icon type='image/ico'> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> </head> <body> <div class='navbar navbar-default navbar-fixed-top' data-offset-top=30 data-spy=affix id=nav role=navigation> <div class=container> <div class=navbar-header> <button class=navbar-toggle data-target='.navbar-collapse' data-toggle=collapse>Menu</button> </div> <div class='navbar-collapse collapse'> <ul class='nav navbar-nav'> <li><a href="/">Home</a></li> <li><a href="/about/">About</a></li> <li class=dropdown> <a class=dropdown-toggle data-toggle=dropdown href="#">Blog <span class=caret></span> </a> <ul class=dropdown-menu role=menu> <li> <a href="/archive/">Archive</a> </li> <li> <a href="/tags/">Tags</a> </li> </ul> </li> <li><a href="/contact/">Contact</a></li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class='col-sm-8 col-sm-offset-2 page'> <h2>Spreading Happiness (Happygifs.co) Faster</h2> <p>Vegan hotdogs lead to increased performance. Believe me or not, but itâ€™s true.</p> <p>The actual story was <a target=_blank href="//joshuamauldin.com/">Joshua Mauldin</a>, maker of iOS apps, websites and a lover of design and I to catch up at JJ Red Hot's for lunch. He created BlendConf's excellent t-shirt swag thru his <a target=_blank href="//neuedist.com/">Neuedist</a> project. He told me his new playground is <a target=_blank href="//happygifs.co">happygifs.co</a></p> <p>The website serves a happiness inspiring animated gif. Who doesn't want to share or show their happiness around the holidays? If the first load doesn't please you Scrooge McDuck, hit "Get Happier" and try again. Joshua and I talked of our mutual obsession of page speed and that it wasn't as fast as he would like. Let's see:</p> <h3 id=where>Where</h3> <p>To test the performance of the website, we want to take measurements as close as possible to the server. This is a quick test, so we'll do our best. Geographic distance typically leads to more network hops. More hops means a slower experience for that user, so let's find where happygifs.co lives. <code>traceroute www.happygifs.co</code> shows the site hosted with DigitalOcean, whose <a target=_blank href="https://www.digitalocean.com/community/questions/datacenters-where-are-these-located-is-there-a-plan-for-the-data-center-in-asia-singapore">datacenter is in New York</a>. Of the webpagetest.org testing locations, Virginia is closest. Here's the median of a 5 test run:</p> <style>
           th, td { text-align: center; vertical-align: middle; }
           .header { text-align: center; vertical-align: middle; background-color: lightgrey; }
           .invisible { border: 0px; }
          </style> <table class="table table-bordered table-hover table-condensed table-responsive"> <thead> <tr> <th class=invisible></th> <th>Load Time</th> <th>First Byte</th> <th>Start Render</th> <th><a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/metrics/speed-index" target=_blank>Speed Index</a></th> <th>Time</th> </tr> </thead> <tbody> <tr> <td align=right>First View</td> <td>3.692s</td> <td>0.164s</td> <td>0.590s</td> <td>898</td> <td>3.692s</td> </tr> <tr> <td valign=right>Repeat View</td> <td>2.127s</td> <td>0.125s</td> <td>0.303s</td> <td>540</td> <td>2.127s</td> </tr> </tbody> </table> <h3 id=what>What</h3> <p>In the detailed results linked below you'll see all the tests ran using Chrome on Cable modem speed. How did I decide to use Chrome? By consulting <a target=_blank href="//gs.statcounter.com/#desktop+mobile+tablet-browser_version-na-quarterly-201304-201304-bar">the most popular browswers this quarter by Version &amp; Platform for North Ameria</a>. Other is a combination of everything else and it likely had such a large share since I requested stats including mobile. Chrome did not have the largest individual share but combined it's share was larger than IE's. Not every browser is available in every location so sometimes it's difficult to get consist analysis.</p> <h3 id=when>When</h3> <p>This data seems to be have as you would expect. A repeat view is faster that the first view because the browser should be caching page elements. Yet, the devil is in the details.</p> <p><a target=_blank href="//www.webpagetest.org/result/131218_JH_V8E/">Look at the individual results in the 5 test run</a>. In the screen shots you'll see a different featured image on each request. Thus the runs were all first views. You should notice there's a high degree of variability in the results. The average is masking the range in page load from 1.688 to 9.178 seconds. As you look at the waterfall diagrams you should notice that the variability is happening for 2 different reasons. Either the gif is the slowest page element or the advertisements are. Unfortunately the third party APIs and ad delivery networks are out of Joshua's control.</p> <h3 id=how>How</h3> <p>This whole time we've been in the weeds, let's now look at those large colored letter grades at the top. Greenlit A's all around for "Time to First Byte", "Keep-Alive Enabled", and "Compress Transfer". "Compress Images" is not applicable so there's no rating, "Effective use of CDN" is an X and there's an F for "Cache static content".</p> <p>A <a target=_blank href="//toolbar.netcraft.com/site_report?url=happygifs.co#last_reboot">quick query of Netcraft</a> tells us the site is running nginx 1.2.1 so we know what web server directives to use. TTF is text so we can compress it. Add the following to <code>/etc/nginx/nginx.conf</code> in <code>gzip_types</code> to cover the webfonts:</p> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1</pre></td><td class=code><pre>font/opentype font/truetype application/x-font-ttf application/vnd.ms-fontobject</pre></td></tr></tbody></table> </div> <p>The web server should have the correct MIME type to deliver the custom webfonts. Add to <code>/etc/nginx/mime.types</code></p> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1&#x000A;2&#x000A;3&#x000A;4</pre></td><td class=code><pre>font/opentype                  ott;&#x000A;application/font-woff          woff;&#x000A;application/x-font-ttf         ttf;&#x000A;application/vnd.ms-fontobject  eot;</pre></td></tr></tbody></table> </div> <p>With the fonts served and compressed, now we tell browsers to cache all the static assets. The settings are not the most aggressive possible, instead caching for a month.</p> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1&#x000A;2&#x000A;3&#x000A;4&#x000A;5</pre></td><td class=code><pre>location ~* \.(css|eot|gif|ico|jpg|jpeg|jpe|js|png|svg|svgz|tif|tiff|ttf|woff)$ {&#x000A;  expires 2592000s;&#x000A;  add_header Pragma public;&#x000A;  add_header Cache-Control "public, must-revalidate, proxy-revalidate";&#x000A;}</pre></td></tr></tbody></table> </div> <p>Now there are a few page elements that we may be able to offload from Joshua's site. We can look up if the <a target=_blank href="//cdnjs.com/">css and javascript libraries are available on a CDN</a>. Bootstrap may not be applicable if he's customized it. Here's the URLs to use in his <code>link</code> directives:</p> <div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1&#x000A;2&#x000A;3&#x000A;4&#x000A;5</pre></td><td class=code><pre>//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.0/animate.min.css&#x000A;//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css&#x000A;//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js&#x000A;//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.0/fastclick.min.js&#x000A;//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js</pre></td></tr></tbody></table> </div> <p>Changing the application to store the gifs in Amazon's S3/Cloudfront or a <a target=_blank href="//www.cdnplanet.com/cdns/">competitor</a> CDN could be the next step. With the logs from the site we could forecast his costs to help pick a service.</p> <h3 id=who>Who</h3> <p>The benefitiary is everyone. Faster websites makes us all happy even when the content isn't animated gifs of adorable kittens frockling. A better user experience is what Google rewards in their search results. If you're a website owner it is in your best interest to care about speed.</p> </div> </div> </div> <footer> <div class=container> <hr> <div class=row> <div class=col-sm-9> </div> <div class=col-sm-3> <p class='small text-right'> &copy; Scott E Lundgren, 2014 <br> <a href="../terms-of-service/">Terms of Service</a> <br> <a href="../privacy-policy/">Privacy Policy</a> </p> </div> </div> </div> </footer> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js"></script> <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5330af801cfb4f05"></script> <script src="/javascripts/all-4be8ae8d.js"></script> <script>!function(e,n,t,a,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=n.createElement(t),s=n.getElementsByTagName(t)[0],o.async=1,o.src=a,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-34315416-1","scottelundgren.com"),ga("send","pageview");</script> </body> </html>